{
  "hash": "94a0385064aec44278368f127d3c0267",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: Explore Annual Maximum daily Precipitation in Brazil\nauthor: To be defined\n---\n\n::: {.cell}\n\n```{.r .cell-code .hidden}\n#| echo: false\n#| warning: false\n\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nWarning: package 'tidyverse' was built under R version 4.2.2\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\n── Attaching packages ─────────────────────────────────────── tidyverse 1.3.2 ──\n✔ ggplot2 3.3.6     ✔ purrr   0.3.4\n✔ tibble  3.1.7     ✔ dplyr   1.0.9\n✔ tidyr   1.2.0     ✔ stringr 1.4.0\n✔ readr   2.1.2     ✔ forcats 0.5.1\n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\n```\n\n\n:::\n\n```{.r .cell-code .hidden}\n#| echo: false\n#| warning: false\n\nlibrary(lubridate)\n```\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\nWarning: package 'lubridate' was built under R version 4.2.1\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr .hidden}\n\n```\n\nAttaching package: 'lubridate'\n\nThe following objects are masked from 'package:base':\n\n    date, intersect, setdiff, union\n```\n\n\n:::\n:::\n\n\n\nO código abaixo lê o arquivo original gerado pelo Eng. Saulo Aires de Souza, que contém os valores das precipitações máximas diárias e respectivos anos. Esse código só deve ser gerado de novo caso um novo arquivo original seja atualizado. Caso contrário, deve-se utilizar o arquivo RDS contido no diretório.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#| label: generate-main-dataframe\n#| echo: true\n#| eval: false\n#| warning: false\n# Code written by Thiago Lappicy with comments by Dirceu Reis\n\n# Extract metadata only (first 15 lines)\nPd_metadata <-\n  read.csv(\"DADOS_CONV_SAULO.dat\", header = FALSE, sep = \";\",\n           nrows = 15, dec = \".\",na.strings = \"null\",\n           fileEncoding = \"latin1\")\n\n# Extract Dates and Annual Maximum Daily Precipitation (20th to 112nd lines)\nPd_tmp <-\n  read.csv(\"DADOS_CONV_SAULO.dat\", header = TRUE, sep = \";\",\n           skip = 20, dec = \".\", na.strings = \"null\")\n\n# Create an empty dataframe with the correct columns\nPd <- as.data.frame(matrix(data = NA, nrow = 0, ncol = 17))   \n\n# Name the columns\ncolnames(Pd) <- c(\"Date\", \"Pdmax\", Pd_metadata[,1])\n\n# Combine both dataframes with only one column for \"Data\" and one for \"Pdmax\"\n# Obs: the original file contains one column in excess. That is why we use \n# \"to = ncol(Pd_metadata) - 1\" in the function \"seq\" below\n\nfor(i in seq(from = 1, to = ncol(Pd_metadata) - 1, by = 2)){\n  \n  # Printar uma mensagem a cada 500 estações pra ter certeza que ta rodando\n  if((i+1) %% 500 == 0) cat(\"Rodando iteração: \", i+1, \"...\\n\")\n  \n  # Include the metadata contained in Pd_metadata\n  # Get only the second column of station \"i\" and transpose the whole column\n  # so it becomes a line with metadata\n  metadata_proxy <- as.data.frame(t(Pd_metadata[,(i+1)])) \n  # Copy metadata to all possible observations (max.number.observations = 112)\n  metadata_proxy[1:112,] <- metadata_proxy\n  # Name the column\n  colnames(metadata_proxy) <- Pd_metadata[,1]\n  \n  # Include the annual maximum daily Precip and Date (Date + Pdmax + Metadata)\n  Pd[(nrow(Pd)+1):(nrow(Pd)+nrow(Pd_tmp)),] <-\n    cbind(Pd_tmp[,c(i, i+1)], metadata_proxy)\n  \n}\n\n\n# Zerar as linhas que tem valores NAs de Data E valor (2 terços +-)\n# 425600 pra 156529\nPd <- Pd[-which(is.na(Pd$Pdmax) & is.na(Pd$Date)),]\n\nsaveRDS(Pd, \"Pd.rds\")\n\nrm(metadata_proxy)\nrm(Pd_metadata)\nrm(Pd_tmp)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#| label: gera-resumo-dados\n#| echo: true\n\n# Load te data\nPd <- readRDS(\"Pd.rds\")\n\n# Create a new column with the year of the observation right after the date\nPd <- Pd %>% mutate(Ano = year(as.Date(Date,\"%d/%m/%Y\")), .after = Date)\n\nn_stations_year <- Pd %>% select(c(2,4)) %>%\n  count(Ano)\n\nn_stations_year_bacia <- Pd %>% select(c(2,4)) %>%\n  count(Ano,BaciaCodigo)\n```\n:::\n\n::: {#cell-fig-number-stations .cell}\n\n```{.r .cell-code .hidden}\n#| label: fig-number-stations\n#| fig-cap: \"Número de estações Plu no Brasil\"\n#| fig-alt: \"Estações Plu no Brasil com disponibilidade de chuvas diárias.\"\n\nggplot() +\n  geom_line(data = n_stations_year,aes(Ano,n),colour = 'black', size = 1) +\n   labs(title = \"Chuva Máxima Diária no Brasil\", subtitle = \"Número de estações\",\n       caption = \"fonte dos dados: ANA (2022)\",\n       x = \"Datas\", y = \"Estações\") +\n  theme_bw()\n```\n\n::: {.cell-output-display}\n![Número de estações Plu no Brasil](explore_daily_precip_files/figure-ipynb/fig-number-stations-1.png){#fig-number-stations fig-alt='Estações Plu no Brasil com disponibilidade de chuvas diárias.'}\n:::\n:::\n",
    "supporting": [
      "explore_daily_precip_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": null,
    "postProcess": false
  }
}